!function(){"use strict";function e(e,a,t,n){return new(t||(t=Promise))((function(i,r){function s(e){try{c(n.next(e))}catch(e){r(e)}}function o(e){try{c(n.throw(e))}catch(e){r(e)}}function c(e){var a;e.done?i(e.value):(a=e.value,a instanceof t?a:new t((function(e){e(a)}))).then(s,o)}c((n=n.apply(e,a||[])).next())}))}function a(a){return e(this,void 0,void 0,(function*(){const e=figma.currentPage.selection.length;if(1===e){const e=figma.currentPage.selection[0],t={type:"IMAGE",scaleMode:"FILL",imageHash:figma.createImage(new Uint8Array(a)).hash};e.fills=[t]}else if(0===e){const e=figma.createFrame();e.name="snappy",e.resize(200,200);const t=200,n=new Uint8Array(a);let i=figma.createImage(n),r=figma.createRectangle();r.resize(t,t),r.fills=[{imageHash:i.hash,scaleMode:"FILL",scalingFactor:.5,type:"IMAGE"}],e.appendChild(r),e.layoutAlign="STRETCH",e.layoutGrow=1,e.layoutMode="HORIZONTAL"}else e>1&&figma.currentPage.selection.forEach((e=>{const t={type:"IMAGE",scaleMode:"FILL",imageHash:figma.createImage(new Uint8Array(a)).hash};e.fills=[t]}));figma.closePlugin()}))}figma.on("run",(({parameters:t})=>e(void 0,void 0,void 0,(function*(){(null==t?void 0:t.prompt.length)>0?figma.showUI(`<script>\n        (async (event) => {\n          try {\n            const response = await fetch('https://snappysnappy.herokuapp.com/create', {\n              method: 'POST',\n              body: JSON.stringify({ data: { prompt: '${t.prompt}' }}),\n              headers: {\n                'Content-Type': 'application/json',\n                'Access-Control-Allow-Origin': 'true',\n                'Access-Control-Allow-Credentials': 'true',\n                'Access-Control-Allow-Methods': 'POST, PUT, PATCH, GET, DELETE, OPTIONS',\n                'Access-Control-Allow-Headers': 'Origin, X-Api-Key, X-Requested-With, Content-Type, Accept, Authorization',\n              },\n            });\n        \n            let data = await response.text();\n        \n            function base64ToArrayBuffer(base64) {\n              var binary_string = atob(base64);\n              var len = binary_string.length;\n              var bytes = new Uint8Array(len);\n              for (var i = 0; i < len; i++) {\n                bytes[i] = binary_string.charCodeAt(i);\n              }\n              return bytes.buffer;\n            }\n\n            const arrayBuffer = base64ToArrayBuffer(data);\n            parent.postMessage({ pluginMessage: { type: 'prompt-from-searchBar', data: arrayBuffer } }, '*');\n          } catch (err) {\n            console.log('error - ', err);\n          }\n        })();        \n        <\/script>`,{visible:!1,width:200,height:200}):(figma.showUI(__html__,{width:320,height:480,title:"Snappy"}),figma.ui.onmessage=t=>{switch(t.type){case"login":!function(){e(this,void 0,void 0,(function*(){(yield figma.clientStorage.getAsync("user"))||figma.ui.postMessage({name:"userNotAuthenticated"})}))}();break;case"prompt":break;case"render-image":!function(e){const a=figma.currentPage.selection.length;if(1===a){const a=figma.currentPage.selection[0],t={type:"IMAGE",scaleMode:"FILL",imageHash:figma.createImage(new Uint8Array(e)).hash};return void(a.fills=[t])}if(0===a){const a=200,t=new Uint8Array(e);let n=figma.createImage(t),i=figma.createRectangle();i.resize(a,a),i.fills=[{imageHash:n.hash,scaleMode:"FILL",scalingFactor:.5,type:"IMAGE"}]}else a>1&&figma.currentPage.selection.forEach((a=>{const t={type:"IMAGE",scaleMode:"FILL",imageHash:figma.createImage(new Uint8Array(e)).hash};a.fills=[t]}))}(t.data);break;case"prompt-from-searchBar":a(t.data);break;case"increase-height":figma.ui.resize(320,620);break;case"decrease-height":figma.ui.resize(320,480);break;case"lexica-image-url":!function(e){if(figma.currentPage.selection.length>1)return void figma.currentPage.selection.forEach((a=>{const t={type:"IMAGE",scaleMode:"FILL",imageHash:figma.createImage(new Uint8Array(e)).hash};a.fills=[t]}));const a=200,t=e;let n=figma.createImage(t),i=figma.createRectangle();i.resize(a,a),i.fills=[{imageHash:n.hash,scaleMode:"FILL",scalingFactor:.5,type:"IMAGE"}]}(t.data)}})})))),figma.ui.onmessage=e=>{if("prompt-from-searchBar"===e.type)a(e.data)},figma.on("selectionchange",(()=>{if(1===figma.currentPage.selection.length){figma.getNodeById(figma.currentPage.selection[0].id).exportAsync({format:"SVG"}).then((e=>{figma.ui.postMessage({type:"selected_node_bytes_data",name:"selected_node_bytes_data",data:e})})),figma.ui.postMessage({type:"selected_node",name:figma.currentPage.selection[0].name,data:{id:figma.currentPage.selection[0].id,type:figma.currentPage.selection[0].type}})}else figma.currentPage.selection.length>1?figma.ui.postMessage({name:"Select one item",data:void 0,node:void 0}):figma.ui.postMessage({name:"No area selected",data:void 0,node:void 0})}))}();
